# Three.js 开放世界游戏原型

这是一个使用Three.js构建的开放世界游戏原型，包含基本的地形生成、玩家控制、基础物体和光照系统。

## 功能特性

- 基于噪声函数的程序化地形生成
- 第一人称相机控制系统
- 完整的物理和碰撞系统
  - 与地形的碰撞检测
  - 与环境物体（树木、岩石）的碰撞检测
  - 能够站立在物体上方
- 树木和岩石等环境元素
- 日光和环境光照系统

## 运行项目

1. 克隆项目
```
git clone <项目地址>
cd threejs-open-world
```

2. 安装依赖
```
npm install
```

3. 启动开发服务器
```
npm run dev
```

4. 在浏览器中打开 http://localhost:5173

## 控制说明

- WASD或方向键 - 移动
- 鼠标 - 视角控制
- 空格键 - 跳跃（可以跳到岩石和树木上面）
- 点击游戏窗口 - 锁定鼠标指针（按ESC解除锁定）

## 相机控制系统说明

本项目实现了一个层次化的第一人称相机控制系统，由三个主要部分组成：

### 对象层次结构

1. **yawObject（偏航对象）**：
   - 最顶层对象，控制左右旋转（绕Y轴）
   - 相当于玩家的整个身体
   - 位置等同于玩家在世界中的位置

2. **pitchObject（俯仰对象）**：
   - yawObject的子对象，控制上下旋转（绕X轴）
   - 相当于玩家的头部
   - Y轴位置设为2，模拟头部高度

3. **camera（相机）**：
   - pitchObject的子对象
   - 相当于玩家的眼睛
   - 位置设为原点(0,0,0)，位于pitchObject中心

### 运作原理

- **左右看（水平旋转）**：
  旋转yawObject的Y轴，整个系统（包括相机）跟随旋转
  
- **上下看（垂直旋转）**：
  旋转pitchObject的X轴，垂直视角受限于-90°到90°，防止过度旋转
  
- **移动**：
  通过WASD控制，移动方向与相机朝向同步，实现自然的第一人称控制

这种设计模拟了人类头部和眼睛的自然运动，提供了沉浸式的游戏体验。

## 碰撞系统说明

本项目实现了一个多层次的碰撞检测系统，用于处理玩家与环境之间的物理交互：

### 碰撞检测类型

1. **地形碰撞**：
   - 使用地形高度图进行精确的高度检测
   - 确保玩家不会穿透地面
   - 支持不同地形高度的自然过渡

2. **环境物体碰撞**：
   - 基于简单的圆柱体碰撞模型
   - 为不同类型的物体（树木、岩石）设置不同的碰撞半径
   - 当发生侧向碰撞时，施加推力将玩家推开

3. **物体站立功能**：
   - 允许玩家跳跃到环境物体上方
   - 为不同物体类型计算准确的顶部高度
   - 实现与地面类似的站立体验

### 碰撞处理流程

1. **收集可碰撞对象**：
   - 世界类（World）生成并维护可碰撞物体列表
   - 包含物体类型、位置、尺寸等碰撞相关参数

2. **检测优先级**：
   - 首先检查玩家是否站在物体上方
   - 然后检查玩家是否接触地面
   - 最后检查是否与物体发生侧向碰撞

3. **碰撞响应**：
   - 对垂直碰撞：调整高度并停止下落
   - 对水平碰撞：计算推力方向，防止穿透

这种设计使玩家能够与世界进行自然的物理交互，增强了游戏的沉浸感和可玩性。

## 技术栈

- Three.js
- JavaScript
- Vite

## 未来计划

- 添加更多环境变化（如白天/黑夜循环）
- 改进地形生成算法
- 添加水体和其他景观特性
- 添加更多互动元素
- 优化性能和加载时间
- 增强碰撞系统，支持更多复杂形状
- 添加不同表面的特殊效果（如滑动、弹跳等） 